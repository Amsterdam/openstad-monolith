{% extends '../base.njk' %}

{% set pageTitle = 'Idee: '+idea.title %}
{% set contentClass = 'idea' %}

{% block content %}
	<h1>{{idea.title}}</h1>

	{{idea.description}}
	
	{% if can('idea:vote') %}
		<hr>
	{% endif %}
	
	<div class="buttons">
		{% if can('idea:edit') %}
			<form class="action" action="/idea/{{idea.id}}/edit">
				<input type="submit" value="Bewerk idee">
			</form>
		{% endif %}
		
		{% if can('idea:delete') %}
			<form class="action" method="POST" action="/idea/{{idea.id}}/delete">
				<input type="hidden" name="_method" value="DELETE">
				<input type="hidden" name="_csrf" value="{{csrfToken}}">
				<input type="submit" value="Verwijder idee">
			</form>
		{% endif %}

		{% if can('idea:vote') %}
			<form class="action vote" method="POST" action="/idea/{{idea.id}}/vote">
				<input type="hidden" name="_csrf" value="{{csrfToken}}">
				<input type="submit" name="yes" value="+ ({{idea.yes}})">
				<input type="submit" name="no" value="- ({{idea.no}})">
				<input type="submit" name="abstain" value="~ ({{idea.abstain}})">
			</form>
		{% endif %}
	</div>
	
	{% if can('idea:admin') %}
		<hr>
		
		<form method="POST" action="/idea/{{idea.id}}/status">
			<select name="status">
				<option {{'selected' if idea.status=='RUNNING'}}  value="RUNNING">Open</option>
				<option {{'selected' if idea.status=='ACCEPTED'}} value="ACCEPTED">Geaccepteerd</option>
				<option {{'selected' if idea.status=='DENIED'}}   value="DENIED">Afgewezen</option>
				<option {{'selected' if idea.status=='BUSY'}}     value="BUSY">In behandeling</option>
				<option {{'selected' if idea.status=='DONE'}}     value="DONE">Afgerond</option>
			</select>
			<input type="hidden" name="_method" value="PUT">
			<input type="hidden" name="_csrf" value="{{csrfToken}}">
			<input type="submit" value="Pas aan">
		</form>
	{% endif %}
	
	{% macro argList( sentiment, arguments ) %}
		{% if can('arg:add') %}
			<form method="POST" action="/idea/{{idea.id}}/arg">
				<textarea name="description"></textarea>
				<input type="hidden" name="_csrf" value="{{csrfToken}}">
				<input type="hidden" name="sentiment" value="{{sentiment}}">
				<input type="submit" value="Toevoegen">
			</form>
		{% endif %}
		
		{% for arg in arguments %}
			<div class="argument">
				<div class="user">
					{{arg.user.firstName}} {{arg.user.lastName}}
					{% if user.can('arg:edit', arg) %}
					[<a href="idea/{{idea.id}}/arg/{{arg.id}}/edit">bewerk</a>]
					{% endif %}
				</div>
				{{arg.description}}
			</div>
		{% else %}
			<i>Geen argumenten.</i>
		{% endfor %}
	{% endmacro %}
	
	<hr>
	
	<div id="arguments">
		<div class="argList for">
			<h3>Argumenten voor</h3>
			{{argList('for', idea.argumentsFor)}}
		</div>
		<div class="argList against">
			<h3>Argumenten tegen</h3>
			{{argList('against', idea.argumentsAgainst)}}
		</div>
	</div>
{% endblock %}