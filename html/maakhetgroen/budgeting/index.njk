{% extends 'base.njk' %}
{% import 'includes/ideas-gridder-list.html' as ideasList %}
{% import 'includes/budgeting.html' as budgeting %}

{% set pageTitle    = 'Stemmen' %}
{% set contentClass = 'ideasList' %}
{% set activeMenu   = 'budget' %}

{% block contentFullWidth %}

	{% if config["voting"].isActive %}
		<div class="pageContent {{contentClass}}" style="margin-top: -40px;">
			<div id="info-bewoners-west" class="info-block green">
				Alle bewoners, ondernemers en gebruikers van de Zuidas mogen stemmen t/m 21 juli.
				<div class="close-button" onclick="hideInfoBewonersWest()"></div>
			</div>
		</div>
		{{ budgeting.showBudgetWindow(config) }}
	{% endif %}

	<script>
	 var csrfToken = '{{csrfToken}}';
	 var userHasVoted = {{userHasVoted}};
	 var userIsLoggedIn = {{userIsLoggedIn}};
	 var authServerLogoutUrl = '{{authServerLogoutUrl}}';
	 var defaultSort = 	{% if config["voting"].isActive %}'random'{% else %}'ranking'{% endif %}

	</script>

	{% include 'includes/end-date-bar.njk' %}

	<div id="ideasList" class="pageContent {{contentClass}} {{config["voting"].votingType}}">

		<h1>
			Plannen voor Zuidas ({{runningIdeas.length}})
		</h1>

		{{ ideasList.showIdeasList(runningIdeas, fullHost, user, userHasVoted, isAdmin) }}

	</div>
{% endblock %}

{% block scripts %}
	<script src="/js/sticky.js"></script>
	<script src="/js/accordion.js"></script>

	<script>

	 // todo: dit stat nu hier omdat je anders de indeen nog niet hebt, maar zou natuurlijk in de widget moeten

	 // var stepNo       = '{{stepNo}}'           || openstadGetCookie('stepNo')		    || '';
	 // var ideaId		    = '{{userVoteIdeaId}}'   || openstadGetCookie('ideaId')		    || '';
	 // var zipCode	    = '{{user.zipCode}}'     || openstadGetCookie('zipCode')	    || '';
	 // var email		    = '{{user.email}}'	     || openstadGetCookie('email')		    || '';
	 // var hasVoted     = {{userHasVoted}}       || openstadGetCookie('hasVoted')     || '';
	 // var hasConfirmed = {{userHasConfirmed}}   || openstadGetCookie('hasConfirmed') || '';
	 //
	 //
	 // var match = window.location.hash.match(/showidea-(\d+)/);
	 // var showIdeaId = match ? match[1] : undefined;
	 // showIdeaId
	 //
	 // // tmp
	 // // var match = window.location.search.match(/stepNo=(\d+)/);
	 // // if (match) {
	 // //  	 currentStep = parseInt( match[1] );
	 // //  	 hideStep(steps[0]);
	 // //  	 showStep(steps[currentStep])
	 // // }
	 //
	 // // var match = window.location.search.match(/zipCode=([a-zA-Z0-9]{6})/);
	 // // if (match) {
	 // //  	 zipCode = match[1];
	 // // }
	 // document.querySelector('input[name=zipCode]').value = zipCode;
	 //
	 // // var match = window.location.search.match(/email=([^&]+)/);
	 // // if (match) {
	 // //  	 email = match[1];
	 // // }
	 // document.querySelector('input[name=email]').value = email;
	 //
	 // // var match = window.location.search.match(/ideaId=(\d+)/);
	 // // if (match) {
	 // //  	 ideaId = match[1];
	 // // }
	 // // document.querySelector('input[name=ideaId]').value = ideaId;
	 //
	 // var match = window.location.hash.match(/closed/);
	 // if (match) {
	 //  	 hideVoteCreator();
	 //  	 console.log('doClose')
	 // } else {
	 //
	 //  	 if (hasConfirmed) {
	 //  		 setHasConfirmed();
	 //  	 } else {
	 //  		 if (hasVoted) {
	 //  			 setHasVoted();
	 //  		 }
	 //  	 }
	 //
	 //  	 var match = window.location.hash.match(/vote-creator-anchor/);
	 //  	 if (match) {
	 //  		 showVoteCreator();
	 //  	 }
	 //
	 //  	 if (ideaId) {
	 //  		 showVoteCreator()
	 //  		 selectIdea(ideaId, true);
	 //  	 }
	 //
	 //  	 setNextButton();
	 //
	 // }
	 //
	 // window.onload = function(){
	 //  	 var match = window.location.search.match(/showIdea=(\d+)/);
	 //  	 if (match) {
	 //  		 showIdeaId = match[1];
	 //  	 };
	 //  	 if (showIdeaId) {
	 //  		 document.querySelector('#idea-' + showIdeaId).click()
	 //  	 }
	 // }

	</script>

{% endblock %}
